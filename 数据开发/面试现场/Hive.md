|        title         | categories |   tags   | date                |
| :------------------: | :--------: | :------: | ------------------- |
| Hive面试相关的知识点 |  fortest   | 数据开发 | 2019/08/13 19:21:21 |

> the life i want，there is not shortcut.

## 0x00Hive

1，Hive的架构，分层

2，Hive的执行流程[延申-hql转换成mr的执行流程]

3，表的join[小表/大表  join 大表 优化]

4，常见的窗口函数

5，行专列，列转行，转数组[三者互转]

6，UDF，UDTF，UDAF函数区别，编写步骤

7，底层使用MR，tez，Spark的区别

8，mysql数据同步数仓的全量/增量

9，数仓流程，你担任了什么角色

10，星型模型和雪花模型

11，缓慢变化维的问题

12，维度建模和实体建模的区别 --数仓CIF架构和总线式的架构有什么区别

13，计算用户在每个页面停留的时间,如果用户离开时没有时间怎么办

14，ETL过程

15，怎么计算七日留存，[中间表] ，如果我要计算一整年的留存？设计一个模型或者算法

```
数据量小设计中间表即可
1张用户活跃表 -含-日期和用户ID字段
1张用户留存中间表 -含-用户ID，日期和type字段，type值有0，1，3，7代表当天活跃和1，3，5，7日留存
计算：用户活跃天表 join 用户留存中间表 条件是用户id相等，活跃表时间是开始时间，留存中间表时间为结束时间

但是数据量上来之后，该方案不在使用，伴随着维度的丰富，该方案将更不再合适。
使用算法解决：方案可参考快手的BitBase方案
用户每天的活跃按照0和1进行标识，数据存储在Hbase中，当圈选维度之后，只需要从上往下依次进行与运算即可[具体实现可自行百度]
```

16，用户回流指标计算

17，用户价值计算

18，json怎么解析[get_json_object,jsob_tuple,UDF,优缺点]

19，复杂类型，map，array，struct这些复杂类型的使用场景，怎么解析

20，DW层和集市层的区别

21，数据晚到[漂移]怎么解决

22，数据质量怎么监控

23，元数据怎么管理，血缘关系怎么分析

24，如果来了一个新的需求，而原有的数仓模型不支持此需求，怎么解决

25，数据治理工作怎么做

26，埋点设计

27，指标体系建设

28，A和B都是相同的字段  数据不一样 

A个B取交集相同的ID，然后除以A 

怎么做，在TB级会有什么问题

29，一个90日留存的问题：新用户90日留存

已有数据

T1：访问行为

| 用户id | 访问日期（分区字段,yyyymmdd格式） | 用户类型（0-老用户，1-新用户） |
| ------ | --------------------------------- | ------------------------------ |
|        |                                   |                                |

计算

| 新用户日期 dt1 | 留存日期 dt2（dt2-dt1 <= 90） | dt1 的新用户数 | dt2的留存用户数 |
| -------------- | ----------------------------- | -------------- | --------------- |
|                |                               |                |                 |

说明：dt2的留存用户数 = dt1的新用户中，在dt2访问的用户数
 请写出sql代码，并回答以下问题：

```
1.从信息论的角度出发，哪些数据是计算该任务必要的？.

2.优化问题：哪些计算是冗余的？如何避免？

3.如何设计调度任务，使得结果表可以增量更新？

4.如何得到尽可能多的留存指标，例如从1日留存到90日留存,并且使得所有指标都显示在同一行?
```

30，hive中表格（ods层）保存为textFile格式，数据中有特殊字符，导致数据错误，如何修改代价最小

31，各种压缩格式的选用，为什么这样用，有没有什么注意事项

32，对于往期时间较长的数据，如何处理？

33，修改hive表结构

```
增加一新列时 最后添加cascade，执行效果强制作用到所有分区
eg：alter tablexx 。。。。add column   。。 cascade；
```

34，你提到了谓词下推，对这个你是怎么理解的

```
谓词下推的基本思想：尽可能早的处理表达式(expressions)，默认产生的执行计划在看到数据的地方添加过滤器filter，
但是有些情况过滤filter表达式expressions被推到离第一次看到数据的操作operator更近。如，select a.*, b.* from a join b on
* (a.col1 = b.col1) where a.col1 > 20 and b.col2 > 40
对于以上的查询，谓词(a.col1 > 20) and (b.col2 > 40)没有进行谓词下推。而是在join操作之后而被评估。建议两个filter谓词从a表和b表过滤掉join不必要处理的记录数。谓词下推应该在join之前处理这两个谓词。
改为 select  c.*,d.* from (select a.* from a where a.col1 > 20 )  c
left join 
(select b.* from b where b.col2 > 40) d
on c.col1 = d.col2
谓词下推可通过设置参数hive.optimize.ppd=true来打开。
```

35，hive锁表的情况：有数据如下
20190620
20190621
20190622
20190623
等时间列表，在20190623当天要统计新增会员数，执行逻辑是统计出所有旧会员，如果23当天的数据 not in列表中，即为新增数据，所以一边查询旧会员数，一边将符合条件的新会员插入到20190623分区中，插入过程中自动创建23号分区，结果就是对23好分区中一边操作查找，一边操作插入，同时执行两种操作，分区被锁，表格被锁

```
仅供参考：
解决办法就是将筛选旧会员操作条件限定在23号以前，确保在一个分区中同时只进行一种操作 
```

36，每日的月环比(考虑每月天数不同，考虑跨年)